<% if @message.valid? %>
  <% publish_to @channel do %>
    <% if @message.isPost? %>
      $("#posts").append("<%= j render(@message) %>");
      $("#posts").animate({scrollTop:$("#posts")[0].scrollHeight}, 1000);
    <% else %>
      $("#chat").append("<%= j render(@message) %>");
      $("#chat").animate({scrollTop:$("#chat")[0].scrollHeight}, 1000);
    <% end %>
    $("#new_message")[0].reset();
  <% end %>
<% else %>
  errorString = "The following errors occured:\n\n"
  <% @message.errors.full_messages.each do |msg| %>
    errorString += '<%= msg %>\n';
  <% end %>
  errorString += '\nPlease check and send again.';
  alert(errorString);
<% end %>
